jQuery(function($){var wpbdp_settings_dep_handling={init:function(){var self=this;self.watch={},self.requirements={},$('.wpbdp-settings-setting[data-requirements][data-requirements!=""]').each(function(){var setting_id=$(this).data("setting-id"),reqs=$(this).data("requirements");self.requirements[setting_id]=reqs,$.each(reqs,function(i,req){var rel_setting_id=req[0];"undefined"==typeof self.watch[rel_setting_id]&&(self.watch[rel_setting_id]=[]),self.watch[rel_setting_id].push(setting_id)})}),$.each(self.watch,function(setting_id,affected_settings){setting_id=setting_id.replace("!",""),$('[name="wpbdp_settings['+setting_id+']"], [name="wpbdp_settings['+setting_id+'][]"]').change(function(){$.each(affected_settings,function(i,v){self.check_requirements(v)})})}),$.each(self.requirements,function(setting_id,reqs){self.check_requirements(setting_id)}),$.fn.wpColorPicker&&$(".cpa-color-picker").wpColorPicker()},check_requirements:function(setting_id){for(var reqs=this.requirements[setting_id],$setting=$("#wpbdp-settings-"+setting_id),$row=$setting.closest(".wpbdp-setting-row"),passes=!0,i=0;i<reqs.length;i++){var $field,req_name=reqs[i][0].replace("!",""),not=-1!==reqs[i][0].indexOf("!"),value=reqs[i][1],$rel_setting=$("#wpbdp-settings-"+req_name);if($rel_setting.length>0&&($rel_setting.closest(".wpbdp-setting-row").hasClass("wpbdp-setting-disabled")?value=!1:$rel_setting.hasClass("wpbdp-settings-type-select")?($field=$rel_setting.find('[name="wpbdp_settings['+req_name+']"]').val(),value=""!==$field):($field=$rel_setting.find('[name="wpbdp_settings['+req_name+']"]:checked, [name="wpbdp_settings['+req_name+'][]"]:checked'),value=$field.length>0)),passes=not?not&&!value:value,!passes)break}passes?$row.removeClass("wpbdp-setting-disabled"):$row.addClass("wpbdp-setting-disabled"),"undefined"!=typeof this.watch[setting_id]&&$setting.find('[name="wpbdp_settings['+setting_id+']"], [name="wpbdp_settings['+setting_id+'][]"]').trigger("change")}};wpbdp_settings_dep_handling.init();var wpbdp_settings_licensing={init:function(){0!=$(".wpbdp-settings-type-license_key").length&&$(".wpbdp-license-key-activate-btn, .wpbdp-license-key-deactivate-btn").click(function(e){e.preventDefault();var $button=$(this),$setting=$(this).parents(".wpbdp-license-key-activation-ui"),$msg=$setting.find(".wpbdp-license-key-activation-status-msg"),activate=($setting.find(".spinner"),$(this).is(".wpbdp-license-key-activate-btn")),$field=$setting.find("input.wpbdp-license-key-input"),data=$setting.data("licensing");$msg.hide(),$button.data("original_label",$(this).val()),$button.val($(this).data("working-msg")),$button.prop("disabled",!0),activate?data.action="wpbdp_activate_license":data.action="wpbdp_deactivate_license",data.license_key=$field.val(),$.post(ajaxurl,data,function(res){if(res.success){if($msg.removeClass("status-error notice-error").addClass("status-success notice-success").html(res.message).show(),activate){var classes=$setting.attr("class").split(" ").filter(function(item){var className=item.trim();return 0!==className.length&&!className.match(/^wpbdp-license-status/)});classes.push("wpbdp-license-status-valid"),$setting.attr("class",classes.join(" "))}else $setting.removeClass("wpbdp-license-status-valid").addClass("wpbdp-license-status-invalid");$field.prop("readonly",!!activate)}else $msg.removeClass("status-success notice-success").addClass("status-error notice-error").html(res.error).show(),$setting.removeClass("wpbdp-license-status-valid").addClass("wpbdp-license-status-invalid"),$field.prop("readonly",!1);$button.val($button.data("original_label")),$button.prop("disabled",!1)},"json")})}};wpbdp_settings_licensing.init();var wpbdp_settings_email={init:function(){$(".wpbdp-settings-email-preview, .wpbdp-settings-email-edit-btn").click(function(e){e.preventDefault();var $email=$(this).parents(".wpbdp-settings-email");$(this).hide(),$email.find(".wpbdp-settings-email-editor").show()}),$(".wpbdp-settings-email-editor .cancel").click(function(e){e.preventDefault();var $email=$(this).parents(".wpbdp-settings-email"),$editor=$email.find(".wpbdp-settings-email-editor");if($email.parent().is("#wpbdp-settings-expiration-notices-add"))return $email.hide(),void $("#wpbdp-settings-expiration-notices-add-btn").show();var subject=$editor.find(".stored-email-subject").val(),body=$editor.find(".stored-email-body").val();if($editor.find(".email-subject").val(subject),$editor.find(".email-body").val(body),$email.hasClass("wpbdp-expiration-notice-email")){var event=$editor.find(".stored-notice-event").val(),reltime=$editor.find(".stored-notice-relative-time").val();$editor.find(".notice-event").val(event),$editor.find(".notice-relative-time").val(reltime),reltime||(reltime="0 days"),$editor.find("select.relative-time-and-event").val(event+","+reltime)}$editor.hide(),$email.find(".wpbdp-settings-email-preview").show()}),$(".wpbdp-settings-email-editor .delete").click(function(e){e.preventDefault();var $email=$(this).parents(".wpbdp-settings-email");$email.find("input.email-subject").val(""),$email.find("input.email-body").val(""),$("#wpbdp-admin-page-settings form:first").submit()}),$(".wpbdp-expiration-notice-email select.relative-time-and-event").change(function(e){var parts=$(this).val().split(","),event=parts[0],relative_time=parts[1],$email=$(this).parents(".wpbdp-settings-email");$email.find(".notice-event").val(event),$email.find(".notice-relative-time").val(relative_time)}),$("#wpbdp-settings-expiration-notices-add-btn").click(function(e){e.preventDefault();var $container=$("#wpbdp-settings-expiration-notices-add .wpbdp-expiration-notice-email"),$editor=$container.find(".wpbdp-settings-email-editor");$(this).hide(),$container.show(),$editor.show()}),$('#wpbdp-settings-expiration-notices-add input[type="submit"]').click(function(e){var $editor=$(this).parents(".wpbdp-settings-email-editor");return $editor.find("input, textarea, select").each(function(i){var name=$(this).attr("name");name&&-1!=name.indexOf("new_notice")&&(name=name.replace("new_notice","wpbdp_settings[expiration-notices]"),$(this).prop("name",name))}),!0})}};wpbdp_settings_email.init()});