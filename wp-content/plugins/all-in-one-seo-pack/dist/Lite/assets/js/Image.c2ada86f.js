import{V as h}from"./vueComponentNormalizer.87056a83.js";import{s as r}from"./index.8900b7f9.js";import{a as u,i as l}from"./context.04ada340.js";import{i as c,b as f}from"./helpers.aa477dea.js";const p=()=>{let t=0;return u()&&(t=parseInt(document.getElementById("post_author_override").value)),l()&&(t=window.wp.data.select("core/editor").getEditedPostAttribute("author")),t},I=()=>{const t=document.querySelector("#set-post-thumbnail img");return t?t.getAttribute("src"):""},m=async(t=!1)=>{const e=window.wp.data.select("core/editor"),a=t?e.getEditedPostAttribute("featured_media"):e.getCurrentPost().featured_media;return typeof a=="undefined"?new Promise(i=>setTimeout(()=>i(m(t)),1e3)):a},d=async()=>{if(u())return I();if(l()){const t=await m(!0).then(e=>e);return isNaN(t)||t===0?"":await r.dispatch("getMediaData",{mediaId:t}).then(e=>e.source_url)}return""},O={data(){return{excludedTermOptions:["featured","attach","content","author","auto"],excludedAttachmentOptions:["featured","content","author"],excludedPageBuilderOptions:["auto"]}},computed:{imageSourceOptions(){return[{label:"Default Image (Set Below)",value:"default"},{label:"Featured Image",value:"featured"},{label:"Attached Image",value:"attach"},{label:"First Image in Content",value:"content"},{label:"Image from Custom Field",value:"custom"},{label:"Post Author Image",value:"author"},{label:"First Available Image",value:"auto"}]},imageSourceOptionsFiltered(){const t=this.imageSourceOptions.map(e=>(e.value==="default"&&(e.label="Default Image Source (Set in Social Networks)"),e)).concat({label:"Custom Image",value:"custom_image"});return this.currentPost.context==="term"?t.filter(e=>!this.excludedTermOptions.includes(e.value)):this.currentPost.context==="post"&&this.currentPost.postType==="attachment"?t.filter(e=>!this.excludedAttachmentOptions.includes(e.value)):this.$aioseo.integration?(this.$aioseo.integration==="seedprod"&&this.excludedPageBuilderOptions.push("featured","custom"),t.filter(e=>!this.excludedPageBuilderOptions.includes(e.value))):t}},methods:{getTermImageSourceOptions(){return this.imageSourceOptions.filter(t=>!this.excludedTermOptions.includes(t.value))},getImageSourceOption(t){return this.imageSourceOptions.find(e=>e.value===t)},getImageSourceOptionFiltered(t){return this.imageSourceOptionsFiltered.find(e=>e.value===t)}}},g=()=>{let t=null;const e=/<img.*?src=['"](.*?)['"].*?>/i.exec(f());return e&&e[1]&&(t=e[1]),t},b=async(t,e,a)=>{let i=c(t[`${a}image_custom_fields`]);return i||await d().then(o=>{i=o}),i||await r.dispatch("getFirstAttachedImage",{postId:t.id}).then(o=>{i=o}),i||(i=g()),i||(i=globalThis.options.social[e].homePage.image),i},_=()=>{const t=p(),e=h.prototype.$aioseo.user.siteAuthors.find(a=>t===a.id);if(e&&e.gravatar){const a=new URL(e.gravatar);return`${a.origin+a.pathname}.jpg${a.search}`}return""},S={data(){return{imageUrl:"",loading:!1}},async mounted(){await this.setImageUrl()},methods:{async setImageUrl(t=""){var n;const e=this.currentPost,a=t||((n=this.metaBoxTabs)==null?void 0:n.social)||"facebook",i=a==="facebook"||a==="twitter"&&e.twitter_use_og?"og_":"twitter_";let o=e[`${i}image_type`]||"default";switch(o==="default"&&(o=this.options.social[a].general.defaultImageSourcePosts),this.imageUrl="",o){case"featured":this.loading=!0,await d().then(s=>{this.imageUrl=s,this.loading=!1});break;case"attach":this.loading=!0,await r.dispatch("getFirstAttachedImage",{postId:e.id}).then(s=>{this.imageUrl=s,this.loading=!1});break;case"content":this.imageUrl=g();break;case"author":this.imageUrl=_();break;case"auto":this.loading=!0,await b(e,a,i).then(s=>{this.imageUrl=s,this.loading=!1});break;case"custom":this.imageUrl=c(e[`${i}image_custom_fields`]);break;case"custom_image":this.imageUrl=e[`${i}image_custom_url`];break;case"default":default:this.imageUrl=this.options.social[a].general.defaultImagePosts;break}!this.imageUrl&&this.$aioseo.urls.siteLogo&&(this.imageUrl=this.$aioseo.urls.siteLogo),this.$bus.$emit("updateSocialImagePreview",{social:a,image:this.imageUrl})}}},x={data(){return{customUploader:{}}},methods:{openUploadModal(t,e){const a=()=>{const i=this.customUploader[t].state().get("selection").first().toJSON();e(i.url)};if(this.customUploader[t]){this.customUploader[t].open();return}this.customUploader[t]=window.wp.media({title:"Choose Image",button:{text:"Choose Image"},multiple:!1}),this.customUploader[t].on("select",a),this.customUploader[t].open()}}};export{O as I,x as U,S as a};
