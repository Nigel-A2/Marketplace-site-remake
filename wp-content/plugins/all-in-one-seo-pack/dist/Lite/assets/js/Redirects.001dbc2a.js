var A=Object.defineProperty,D=Object.defineProperties;var P=Object.getOwnPropertyDescriptors;var g=Object.getOwnPropertySymbols;var O=Object.prototype.hasOwnProperty,M=Object.prototype.propertyIsEnumerable;var p=(e,r,t)=>r in e?A(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t,n=(e,r)=>{for(var t in r||(r={}))O.call(r,t)&&p(e,t,r[t]);if(g)for(var t of g(r))M.call(r,t)&&p(e,t,r[t]);return e},u=(e,r)=>D(e,P(r));import{a as S,d as c}from"./index.8900b7f9.js";import{C as $,c as b,d}from"./index.652636d3.js";import"./ToolsSettings.a9d9524e.js";import"./context.04ada340.js";import{J as I}from"./JsonValues.08065e69.js";import{n as o}from"./vueComponentNormalizer.87056a83.js";import{C as B}from"./ProBadge.7c0de2f7.js";import{S as q}from"./External.8868c638.js";import{S as T}from"./Close.5e7bcb70.js";import{S as E}from"./Exclamation.356738ce.js";import{B as F}from"./Checkbox.5873a8d2.js";import{C as h}from"./Index.476ddbfd.js";import{G as N,a as V}from"./Row.13b6f3f1.js";import{S as j}from"./Gear.c974e953.js";import{S as L}from"./Trash.214b5744.js";import{T as x}from"./Slide.f5d21606.js";import{C as z}from"./Tooltip.3ec20ff5.js";import{S as H}from"./Plus.a9b9ba75.js";import{C as W}from"./Blur.8490ecd2.js";import{C as Y}from"./Card.f0350b06.js";import{C as G}from"./Table.dfc2977c.js";import{C as Q}from"./Index.abdfd585.js";var J=function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("div",{staticClass:"aioseo-add-redirection-url-results"},[t("ul",e._l(e.results,function(i,s){return t("li",{key:s,on:{click:function(a){return e.$emit("set-url",i.link)}}},[t("span",[t("div",{staticClass:"option"},[t("div",{staticClass:"option-title"},[t("div",{domProps:{innerHTML:e._s(e.getOptionTitle(i.label))}}),i.status!=="publish"?t("core-pro-badge",[e._v(" "+e._s(e.getStatusLabel(i.status))+" ")]):e._e()],1),t("div",{staticClass:"option-details"},[t("span",[e._v(e._s(i.link))])])]),t("a",{staticClass:"option-permalink",attrs:{href:i.link,target:"_blank"},on:{click:function(a){return a.stopPropagation(),function(){}.apply(null,arguments)}}},[t("svg-external")],1)])])}),0)])},K=[];const Z={components:{CoreProBadge:B,SvgExternal:q},props:{results:{type:Array,required:!0},url:String},data(){return{strings:{DRAFT:"DRAFT",PENDING:"PENDING",FUTURE:"FUTURE"}}},methods:{getOptionTitle(e){const r=new RegExp(`(${this.url})`,"gi");return e.replace(r,'<span class="search-term">$1</span>')},getStatusLabel(e){switch(e.toLowerCase()){case"draft":return this.strings.DRAFT;case"future":return this.strings.FUTURE;case"pending":return this.strings.PENDING}}}},f={};var X=o(Z,J,K,!1,ee,null,null,null);function ee(e){for(let r in f)this[r]=f[r]}var w=function(){return X.exports}(),te=function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("div",{ref:"redirect-target-url",staticClass:"aioseo-add-redirection-target-url"},[t("base-input",{class:{"aioseo-error":e.errors.length,"aioseo-active":!e.errors.length&&!e.warnings.length&&e.url,"aioseo-warning":e.warnings.length},attrs:{size:"medium",placeholder:"/target-page/"},on:{keyup:e.searchChange,focus:function(i){e.showResults=!0},input:function(i){return e.$emit("input",e.value)},blur:function(i){return e.$emit("blur",e.value)}},scopedSlots:e._u([{key:"append-icon",fn:function(){return[t("div",{staticClass:"append-icon"},[e.isLoading?e._e():[e.errors.length?t("svg-circle-close"):e._e(),!e.errors.length&&!e.warnings.length&&e.url?t("svg-circle-check"):e._e(),e.warnings.length?t("svg-circle-exclamation"):e._e()],e.isLoading?t("core-loader",{attrs:{dark:""}}):e._e()],2)]},proxy:!0}]),model:{value:e.value,callback:function(i){e.value=i},expression:"value"}}),e.showResults&&e.results.length?t("core-add-redirection-url-results",{attrs:{results:e.results,url:e.value},on:{"set-url":e.setUrl}}):e._e()],1)},re=[];const se={components:{CoreAddRedirectionUrlResults:w,CoreLoader:$,SvgCircleCheck:b,SvgCircleClose:T,SvgCircleExclamation:E},props:{url:String,errors:Array,warnings:Array},data(){return{showResults:!1,isLoading:!1,value:null,results:[]}},watch:{value(){this.value&&(this.value=this.value.replace(/(https?:\/)(\/)+|(\/)+/g,"$1$2$3"),this.value=this.value.replace(/\s+/g,""))},url:{immediate:!0,handler(){this.value=this.url}}},computed:n({},S(["currentPost"])),methods:u(n({},c("redirects",["getPosts"])),{onBlur(){setTimeout(()=>{this.$emit("input",this.value)},150)},searchChange(){if(!!this.value){if(this.value.startsWith("/")||this.value.startsWith("http:")||this.value.startsWith("https:")){this.isLoading=!1;return}this.isLoading=!0,d(()=>{if(!this.value){this.isLoading=!1;return}this.showResults=!0,this.ajaxSearch(this.value).then(()=>this.isLoading=!1)},500)}},ajaxSearch(e){return this.getPosts({query:e,postId:this.currentPost.id}).then(r=>{this.results=r.body.objects})},setUrl(e){this.showResults=!1,this.value=e.replace(this.$aioseo.urls.mainSiteUrl,"",e),this.$emit("input",this.value)},documentClick(e){if(!this.showResults)return;const r=e&&e.target?e.target:null,t=this.$refs["redirect-target-url"];t&&t!==r&&!t.contains(r)&&(this.showResults=!1)}}),mounted(){document.addEventListener("click",this.documentClick)},beforeDestroy(){document.removeEventListener("click",this.documentClick)}},_={};var ie=o(se,te,re,!1,ae,null,null,null);function ae(e){for(let r in _)this[r]=_[r]}var le=function(){return ie.exports}(),ne=function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("div",{ref:"redirect-source-url",staticClass:"aioseo-redirect-source-url"},[t("base-input",{class:{"aioseo-error":e.url.errors.length,"aioseo-active":!e.url.errors.length&&!e.url.warnings.length&&e.url.url,"aioseo-warning":e.url.warnings.length},attrs:{value:e.url.url,disabled:e.log404||e.disableSource,size:"medium",placeholder:"/source-page/"},on:{input:function(i){return e.updateSourceUrl(i)},keyup:e.searchChange,focus:function(i){e.showResults=!0}},scopedSlots:e._u([{key:"append-icon",fn:function(){return[t("div",{staticClass:"append-icon"},[e.isLoading?e._e():[e.url.errors.length?t("svg-circle-close"):e._e(),!e.url.errors.length&&!e.url.warnings.length&&e.url.url?t("svg-circle-check"):e._e(),e.url.warnings.length?t("svg-circle-exclamation"):e._e(),t("svg-gear",{class:{active:e.urlOptionsActive},nativeOn:{click:function(i){e.showOptions=!e.showOptions}}}),e.allowDelete?t("svg-trash",{nativeOn:{click:function(i){return e.$emit("remove-url")}}}):e._e()],e.isLoading?t("core-loader",{attrs:{dark:""}}):e._e()],2)]},proxy:!0}])}),!e.url.regex&&e.showResults&&e.results.length?t("core-add-redirection-url-results",{attrs:{results:e.results,url:e.url.url},on:{"set-url":e.setUrl}}):e._e(),e.log404?e._e():e._t("source-url-description"),t("transition-slide",{staticClass:"source-url-options",attrs:{active:e.showOptions}},[t("div",[t("grid-row",[t("grid-column",{attrs:{xs:"4"}},[t("base-checkbox",{attrs:{size:"medium",value:e.url.ignoreSlash},on:{input:function(i){return e.updateOption("ignoreSlash",i)}}},[e._v(" "+e._s(e.strings.ignoreSlash)+" ")])],1),t("grid-column",{attrs:{xs:"4"}},[t("base-checkbox",{attrs:{size:"medium",value:e.url.ignoreCase},on:{input:function(i){return e.updateOption("ignoreCase",i)}}},[e._v(" "+e._s(e.strings.ignoreCase)+" ")])],1),!e.log404&&!e.disableSource?t("grid-column",{attrs:{xs:"4"}},[t("base-checkbox",{attrs:{size:"medium",value:e.url.regex},on:{input:function(i){return e.updateOption("regex",i)}}},[e._v(" "+e._s(e.strings.regex)+" ")])],1):e._e()],1)],1)]),t("transition-slide",{attrs:{active:!!e.url.errors.length}},e._l(e.url.errors,function(i,s){return t("core-alert",{key:s,staticClass:"source-url-error",attrs:{type:"red",size:"small"},domProps:{innerHTML:e._s(i)}})}),1),t("transition-slide",{attrs:{active:!!e.url.warnings.length}},e._l(e.url.warnings,function(i,s){return t("core-alert",{key:s,staticClass:"source-url-warning",attrs:{type:"yellow",size:"small"},domProps:{innerHTML:e._s(i)}})}),1)],2)},oe=[];const ue={components:{BaseCheckbox:F,CoreAddRedirectionUrlResults:w,CoreAlert:h,CoreLoader:$,GridColumn:N,GridRow:V,SvgCircleCheck:b,SvgCircleClose:T,SvgCircleExclamation:E,SvgGear:j,SvgTrash:L,TransitionSlide:x},props:{url:{type:Object,default(){return{id:null,url:null,regex:!1,ignoreSlash:!0,ignoreCase:!0,errors:[],warnings:[]}}},allowDelete:Boolean,targetUrl:String,log404:Boolean,disableSource:Boolean},data(){return{showResults:!1,isLoading:!1,showOptions:!1,strings:{ignoreSlash:"Ignore Slash",ignoreCase:"Ignore Case",regex:"Regex"},results:[]}},watch:{targetUrl(){this.updateSourceUrl(this.url.url)}},computed:{maybeRegex(){return this.url.url.match(/[*\\()[\]^$]/)!==null||this.url.url.indexOf(".?")!==-1},invalidUrl(){if(!this.url.url)return!1;const e=[];if(this.url.regex)try{new RegExp(this.url.url)}catch{return e.push("The regex syntax is invalid."),e}if(this.url.url.substr(0,4)==="http"&&this.url.url.indexOf(document.location.origin)===-1&&e.push("Please enter a valid relative source URL."),this.url.url.match(/%\w+%/)&&e.push("Permalinks are not currently supported."),(this.url.url==="/(.*)"||this.url.url==="^/(.*)")&&e.push("This redirect is supported using the Relocate Site feature under Full Site Redirect tab."),this.url.url&&this.url.url.length&&this.targetUrl&&this.targetUrl.length){let r=this.url.ignoreSlash?this.$links.unTrailingSlashIt(this.url.url):this.url.url,t=this.url.ignoreSlash?this.$links.unTrailingSlashIt(this.targetUrl):this.targetUrl;r=this.url.ignoreCase?r.toLowerCase():r,t=this.url.ignoreCase?t.toLowerCase():t,(r===t||this.url.regex&&t.match(r))&&e.push("Your source is the same as a target and this will create a loop.")}return e},iffyUrl(){if(!this.url.url)return[];const e=[];return this.url.url.substr(0,4)!=="http"&&this.url.url.substr(0,1)!=="/"&&0<this.url.url.length&&!this.url.regex&&e.push(this.$t.sprintf("The source URL should probably start with a %1$s","<code>/</code>")),this.url.url.indexOf("#")!==-1&&e.push("Anchor values are not sent to the server and cannot be redirected."),!this.log404&&this.maybeRegex&&!this.url.regex&&e.push(this.$t.sprintf("Remember to enable the %1$s option if this is a regular expression.","<code>Regex</code>")),this.url.regex&&(this.url.url.indexOf("^")===-1&&this.url.url.indexOf("$")===-1&&e.push(this.$t.sprintf("To prevent a greedy regular expression you can use %1$s to anchor it to the start of the URL. For example: %2$s","<code>^/</code>","<code>^/"+this.url.url.replace(/^\//,"")+"</code>")),0<this.url.url.indexOf("^")&&e.push(this.$t.sprintf("The caret %1$s should be at the start. For example: %2$s","<code>^/</code>","<code>^/"+this.url.url.replace("^","").replace(/^\//,"")+"</code>")),this.url.url.indexOf("^")===0&&this.url.url.indexOf("^/")===-1&&e.push(this.$t.sprintf("The source URL should probably start with a %1$s","<code>^/</code>")),this.url.url.length-1!==this.url.url.indexOf("$")&&this.url.url.indexOf("$")!==-1&&e.push(this.$t.sprintf("The dollar symbol %1$s should be at the end. For example: %2$s","<code>$</code>","<code>"+this.url.url.replace(/\$/g,"")+"$</code>"))),this.url.url.match(/(\.html|\.htm|\.php|\.pdf|\.jpg)$/)!==null&&e.push("Some servers may be configured to serve file resources directly, preventing a redirect occurring."),e},urlOptionsActive(){return this.url.regex||this.showOptions}},methods:u(n({},c("redirects",["getPosts"])),{updateSourceUrl(e){!e||(e&&(e=e.replace(/(https?:\/)(\/)+|(\/)+/g,"$1$2$3")),this.url.regex||(e=e.replace(/\s+/g,"")),this.$set(this.url,"url",e),this.$set(this.url,"errors",this.invalidUrl),this.$set(this.url,"warnings",this.iffyUrl),this.$emit("updated-url",this.url))},updateOption(e,r){this.$set(this.url,e,r),this.updateSourceUrl(this.url.url),this.$emit("updated-option",this.url)},searchChange(){if(!(!this.url.url||this.url.regex)){if(this.url.url.startsWith("/")||this.url.url.startsWith("^")||this.url.url.startsWith("http:")||this.url.url.startsWith("https:")){this.isLoading=!1;return}this.isLoading=!0,d(()=>{if(!this.url.url){this.isLoading=!1;return}this.showResults=!0,this.ajaxSearch(this.url.url).then(()=>this.isLoading=!1)},500)}},ajaxSearch(e){return this.getPosts({query:e}).then(r=>{this.results=r.body.objects})},setUrl(e){this.showResults=!1,this.updateOption("url",e.replace(this.$aioseo.urls.mainSiteUrl,"",e))},documentClick(e){if(!this.showResults)return;const r=e&&e.target?e.target:null,t=this.$refs["redirect-source-url"];t&&t!==r&&!t.contains(r)&&(this.showResults=!1)}}),mounted(){this.url.showOptions&&(this.showOptions=!0,this.updateSourceUrl(this.url.url)),document.addEventListener("click",this.documentClick)},beforeDestroy(){document.removeEventListener("click",this.documentClick)}},v={};var ce=o(ue,ne,oe,!1,de,null,null,null);function de(e){for(let r in v)this[r]=v[r]}var he=function(){return ce.exports}(),ge=function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("div",{staticClass:"custom-rules"},[t("table",{staticClass:"redirects-options-table",attrs:{cellspacing:"0",cellpadding:"0","aria-label":"Custom Rules"}},[t("thead",[t("tr",[t("td",{attrs:{colspan:"2"}},[e._v(e._s(e.strings.customRules))])])]),t("tbody",e._l(e.customRules,function(i,s){return t("tr",{key:s,staticClass:"rule",class:{even:s%2===0}},[t("td",{staticClass:"rule-settings"},[t("base-select",{attrs:{options:e.filteredTypes,size:"medium",placeholder:e.strings.selectMatchRule,value:e.getRuleValue("type",s)},on:{input:function(a){return e.updateRule("type",a,s)}}}),e.getType(s,"options")||e.getType(s,"taggable")?t("base-select",{attrs:{options:e.getType(s,"options")||[],size:"medium",value:e.getRuleValue("value",s),multiple:e.getType(s,"multiple")||e.getType(s,"taggable"),taggable:e.getType(s,"taggable"),placeholder:e.getType(s,"placeholder")||e.strings.selectAValue},on:{input:function(a){return e.updateRule("value",a,s)}}}):e._e(),e.getType(s,"keyValuePair")?t("base-input",{attrs:{value:e.getRuleValue("key",s),size:"medium",placeholder:e.getType(s,"placeholderKey")||e.strings.key},on:{input:function(a){return e.updateRule("key",a,s)}}}):e._e(),!e.getType(s,"options")&&!e.getType(s,"taggable")?t("base-input",{attrs:{value:e.getRuleValue("value",s),size:"medium",placeholder:e.getType(s,"placeholder")||e.strings.value,disabled:!e.getType(s)},on:{input:function(a){return e.updateRule("value",a,s)}}}):e._e(),e.getType(s,"regex")?t("base-toggle",{attrs:{value:e.getRuleValue("regex",s)},on:{input:function(a){return e.updateRule("regex",a,s)}}},[e._v(" "+e._s(e.strings.regex)+" ")]):e._e()],1),t("td",{staticClass:"actions"},[t("core-tooltip",{staticClass:"action",attrs:{type:"action"},scopedSlots:e._u([{key:"tooltip",fn:function(){return[e._v(" "+e._s(e.strings.delete)+" ")]},proxy:!0}],null,!0)},[t("svg-trash",{nativeOn:{click:function(a){return e.removeRule(s)}}})],1)],1)])}),0),t("tfoot",[t("tr",[t("td",{attrs:{colspan:"2"}},[t("base-button",{attrs:{size:"small-table",type:"black"},on:{click:function(i){return e.addRule(null)}}},[t("svg-circle-plus"),e._v(" "+e._s(e.strings.add)+" ")],1)],1)])])])])},pe=[];const fe={type:null,key:null,value:null,regex:null},_e={components:{CoreTooltip:z,SvgCirclePlus:H,SvgTrash:L},props:{editCustomRules:Array},data(){return{strings:{customRules:"Custom Rules",selectMatchRule:"Select Rule",delete:"Delete",add:"Add Custom Rule",regex:"Regex",selectAValue:"Select a Value or Add a New One",key:"Key",value:"Value"},customRules:[],types:[{label:this.$constants.REDIRECTS_CUSTOM_RULES_LABELS.login,value:"login",placeholder:"Select Status",singleRule:!0,options:[{label:this.$constants.REDIRECTS_CUSTOM_RULES_LABELS.loggedin,value:"loggedin"},{label:this.$constants.REDIRECTS_CUSTOM_RULES_LABELS.loggedout,value:"loggedout"}]},{label:this.$constants.REDIRECTS_CUSTOM_RULES_LABELS.role,value:"role",multiple:!0,placeholder:"Select Roles",options:Object.entries(this.$aioseo.user.roles).map(e=>({label:e[1],value:e[0]}))},{label:this.$constants.REDIRECTS_CUSTOM_RULES_LABELS.referrer,value:"referrer",regex:!0,singleRule:!0},{label:this.$constants.REDIRECTS_CUSTOM_RULES_LABELS.agent,value:"agent",regex:!0,taggable:!0,multiple:!0,options:[{label:this.$constants.REDIRECTS_CUSTOM_RULES_LABELS.mobile,value:"mobile",docLink:this.$links.getDocLink("Learn more","redirectCustomRulesUserAgent",!0)},{label:this.$constants.REDIRECTS_CUSTOM_RULES_LABELS.feeds,value:"feeds",docLink:this.$links.getDocLink("Learn more","redirectCustomRulesUserAgent",!0)},{label:this.$constants.REDIRECTS_CUSTOM_RULES_LABELS.libraries,value:"libraries",docLink:this.$links.getDocLink("Learn more","redirectCustomRulesUserAgent",!0)}]},{label:this.$constants.REDIRECTS_CUSTOM_RULES_LABELS.cookie,value:"cookie",keyValuePair:!0,regex:!0},{label:this.$constants.REDIRECTS_CUSTOM_RULES_LABELS.ip,value:"ip",placeholder:"Enter an IP Address",taggable:!0,regex:!0,singleRule:!0},{label:this.$constants.REDIRECTS_CUSTOM_RULES_LABELS.server,value:"server",placeholder:"Enter the Server Name",regex:!0,singleRule:!0},{label:this.$constants.REDIRECTS_CUSTOM_RULES_LABELS.header,value:"header",keyValuePair:!0,regex:!0},{label:this.$constants.REDIRECTS_CUSTOM_RULES_LABELS.wp_filter,value:"wp_filter",placeholder:"Enter a WordPress Filter Name",taggable:!0},{label:this.$constants.REDIRECTS_CUSTOM_RULES_LABELS.locale,value:"locale",taggable:!0,regex:!0,placeholder:"Enter a Locale Code, e.g.: en_GB, es_ES",singleRule:!0}]}},computed:{hasCustomRules(){return 0<this.customRules.length},filteredTypes(){return this.types.map(e=>(e.$isDisabled=!1,e.singleRule&&this.customRules.find(r=>e.value===r.type)&&(e.$isDisabled=!0),e))}},methods:{removeRule(e){this.$delete(this.customRules,e),this.hasCustomRules||this.addRule(null)},addRule(e,r=!1){e||(e=JSON.parse(JSON.stringify(fe))),(!r||r&&this.customRules.filter(t=>t===e).length===0)&&this.customRules.push(e)},updateRule(e,r,t){const i=this.customRules[t];r=typeof r.value!="undefined"?r.value:r,r=typeof r=="object"&&r.length?r.map(s=>s.value):r,i[e]=r,e==="type"&&(i.value=""),this.$set(this.customRules,t,i)},getRuleValue(e,r,t=!1){if(!this.customRules[r])return;let s=this.customRules[r][e],a=null;if(t)return s;switch(e){case"type":s=this.types.find(l=>s===l.value);break;case"value":a=this.getType(r,"options"),a&&(typeof s=="object"?s=s.map(l=>a.find(k=>l===k.value)||l).filter(l=>!!l):s=a.find(l=>s===l.value)||s),this.getType(r,"taggable")&&(s=typeof s=="object"?s.map(l=>typeof l.label=="undefined"?{label:l,value:l}:l):[]);break}return s},getType(e,r){const t=this.getRuleValue("type",e);return r?t&&typeof t[r]!="undefined"?t[r]:!1:t}},mounted(){this.editCustomRules&&(this.customRules=this.editCustomRules),this.hasCustomRules||this.addRule(null)}},m={};var ve=o(_e,ge,pe,!1,me,"589ca9de",null,null);function me(e){for(let r in m)this[r]=m[r]}var Re=function(){return ve.exports}(),ye=function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("svg",{staticClass:"aioseo-right-arrow",attrs:{width:"36",height:"16",viewBox:"0 0 36 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[t("path",{attrs:{d:"M36 8L28.4211 0.5V6.125H0V9.875H28.4211V15.5L36 8Z",fill:"currentColor"}})])},Ue=[];const Ce={},R={};var Se=o(Ce,ye,Ue,!1,$e,null,null,null);function $e(e){for(let r in R)this[r]=R[r]}var be=function(){return Se.exports}(),Te=function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("div",{staticClass:"aioseo-add-redirection",class:{"edit-url":e.edit,"log-404":e.log404}},[e.genericError?t("core-alert",{staticClass:"generic-error",attrs:{type:"red"}},[e._v(" "+e._s(e.strings.genericErrorMessage)+" ")]):e._e(),t("div",{staticClass:"urls"},[t("div",{staticClass:"source"},[t("div",{staticClass:"aioseo-settings-row no-border no-margin small-padding"},[t("div",{staticClass:"settings-name"},[t("div",{staticClass:"name small-margin"},[e._v(" "+e._s(e.sourceUrl)+": ")])]),e._l(e.sourceUrls,function(i,s){return t("core-add-redirection-url",{key:s,attrs:{url:i,"allow-delete":1<e.sourceUrls.length,"target-url":e.targetUrl,log404:e.log404,disableSource:e.disableSource},on:{"remove-url":function(a){return e.removeUrl(s)}},scopedSlots:e._u([e.edit&&!e.disableSource?{key:"source-url-description",fn:function(){return[t("div",{staticClass:"aioseo-description source-description",domProps:{innerHTML:e._s(e.strings.sourceUrlDescription)}})]},proxy:!0}:null],null,!0)})}),!e.edit&&!e.log404&&!e.disableSource?t("base-button",{attrs:{size:"small",type:"gray"},on:{click:e.addUrl}},[e._v(" "+e._s(e.strings.addUrl)+" ")]):e._e()],2)]),e.redirectTypeHasTarget()?t("div",{staticClass:"url-arrow"},[t("svg-right-arrow")],1):e._e(),e.redirectTypeHasTarget()?t("div",{staticClass:"target"},[t("div",{staticClass:"aioseo-settings-row no-border no-margin small-padding"},[t("div",{staticClass:"settings-name"},[t("div",{staticClass:"name small-margin"},[e._v(" "+e._s(e.strings.targetUrl)+": ")])]),t("div",{staticClass:"url"},[t("core-add-redirection-target-url",{attrs:{url:e.targetUrl,errors:e.targetUrlErrors,warnings:e.targetUrlWarnings},on:{input:e.updateTargetUrl}}),t("div",{staticClass:"aioseo-description"},[e._v(" "+e._s(e.strings.targetUrlDescription)+" ")]),t("transition-slide",{attrs:{active:!!e.targetUrlErrors.length}},[t("div",e._l(e.targetUrlErrors,function(i,s){return t("core-alert",{key:s,staticClass:"target-url-error",attrs:{type:"red",size:"small"},domProps:{innerHTML:e._s(i)}})}),1)]),t("transition-slide",{attrs:{active:!!e.targetUrlWarnings.length}},[t("div",e._l(e.targetUrlWarnings,function(i,s){return t("core-alert",{key:s,staticClass:"target-url-warning",attrs:{type:"yellow",size:"small"},domProps:{innerHTML:e._s(i)}})}),1)])],1)])]):e._e(),!e.edit&&!e.log404&&!e.disableSource?[t("div",{staticClass:"break"}),t("div",{staticClass:"source"},[t("div",{staticClass:"aioseo-description source-description",domProps:{innerHTML:e._s(e.strings.sourceUrlDescription)}})]),t("div",{staticClass:"url-arrow"}),t("div",{staticClass:"target"})]:e._e()],2),t("div",{staticClass:"settings",class:{advanced:e.showAdvancedSettings}},[t("div",{staticClass:"all-settings"},[t("div",{staticClass:"all-settings-content"},[t("div",{staticClass:"redirect-type"},[e._v(" "+e._s(e.strings.redirectType)+" "),t("base-select",{attrs:{options:e.$constants.REDIRECT_TYPES,size:"medium"},model:{value:e.redirectType,callback:function(i){e.redirectType=i},expression:"redirectType"}})],1),t("transition-slide",{staticClass:"advanced-settings",attrs:{active:e.showAdvancedSettings}},[t("div",{staticClass:"query-params"},[e._v(" "+e._s(e.strings.queryParams)+" "),t("base-select",{attrs:{options:e.redirectQueryParams,size:"medium"},model:{value:e.queryParam,callback:function(i){e.queryParam=i},expression:"queryParam"}})],1)]),e.showAdvancedSettings?e._e():t("a",{staticClass:"advanced-settings-link",attrs:{href:"#"},on:{click:function(i){i.preventDefault(),e.showAdvancedSettings=!e.showAdvancedSettings}}},[e._v(e._s(e.strings.advancedSettings))])],1)]),t("transition-slide",{staticClass:"advanced-settings",attrs:{active:e.showAdvancedSettings}},[t("custom-rules",{attrs:{"edit-custom-rules":e.customRules}})],1),t("div",{staticClass:"actions",class:{advanced:e.showAdvancedSettings}},[t("base-button",{attrs:{size:"medium",type:"blue",loading:e.addingRedirect,disabled:e.saveIsDisabled},on:{click:function(i){e.edit?e.saveChanges():e.addRedirects()}}},[e._v(" "+e._s(e.edit?e.strings.saveChanges:e.addRedirect)+" ")]),e.edit?t("base-button",{staticClass:"cancel-edit-row",attrs:{size:"medium",type:"gray"},on:{click:function(i){return e.$emit("cancel",!0)}}},[e._v(" "+e._s(e.strings.cancel)+" ")]):e._e()],1)],1)],1)},Ee=[];const Le={components:{CoreAddRedirectionTargetUrl:le,CoreAddRedirectionUrl:he,CoreAlert:h,CustomRules:Re,SvgRightArrow:be,TransitionSlide:x},mixins:[I],props:{edit:Boolean,log404:Boolean,disableSource:Boolean,url:Object,urls:Array,target:String,type:Number,query:String,slash:Boolean,case:Boolean,rules:{type:Array,default(){return[]}}},data(){return{genericError:!1,showAdvancedSettings:!1,addingRedirect:!1,targetUrl:null,targetUrlErrors:[],targetUrlWarnings:[],sourceUrls:[],redirectType:null,queryParam:null,customRules:[],strings:{redirectType:"Redirect Type:",targetUrl:"Target URL",targetUrlDescription:"Enter a URL or start by typing a page or post title, slug or ID.",addUrl:"Add URL",sourceUrlDescription:this.$t.sprintf("Enter a relative URL to redirect from or start by typing in page or post title, slug or ID. You can also use regex (%1$s)",this.$links.getDocLink("what's this?","redirectManagerRegex")),advancedSettings:"Advanced Settings",queryParams:"Query Parameters:",saveChanges:"Save Changes",cancel:"Cancel",genericErrorMessage:"An error occurred while adding your redirects. Please try again later."}}},watch:{sourceUrls:{deep:!0,handler(){d(()=>this.checkForDuplicates(),500)}}},computed:u(n({},S("redirects",["options"])),{saveIsDisabled(){return!!this.sourceUrls.filter(e=>!e.url).length||!!this.sourceUrls.filter(e=>0<e.errors.length).length||this.redirectTypeHasTarget()&&!this.targetUrl},getRelativeAbsolute(){const e=this.targetUrl.match(/^\/([a-zA-Z0-9_\-%]*\..*)\//);return e?e[0]:null},sourceUrl(){return 1<this.sourceUrls.length?"Source URLs":"Source URL"},addRedirect(){return 1<this.sourceUrls.length?"Add Redirects":"Add Redirect"},hasTargetUrlErrors(){if(!this.targetUrl)return[];const e=[];this.targetUrl&&!this.beginsWith(this.targetUrl,"https://")&&!this.beginsWith(this.targetUrl,"http://")&&this.targetUrl.substr(0,1)!=="/"&&e.push(this.$t.sprintf("Your target URL should be an absolute URL like %1$s or start with a slash.","<code>https://domain.com/"+this.targetUrl+"</code>","<code>/"+this.targetUrl+"</code>"));const r=this.targetUrl.match(/[|\\$]/g);return r!==null&&(this.sourceUrls.map(i=>i.regex).every(i=>i)||e.push(this.$t.sprintf("Your target URL contains the invalid character(s) %1$s","<code>"+r+"</code>"))),e},hasTargetUrlWarnings(){if(!this.targetUrl)return[];const e=[];return this.getRelativeAbsolute&&e.push(this.$t.sprintf("Your URL appears to contain a domain inside the path: %1$s. Did you mean to use %2$s instead?","<code>"+this.getRelativeAbsolute+"</code>","<code>https:/"+this.getRelativeAbsolute+"</code>")),e},getDefaultRedirectType(){let e=this.getJsonValue(this.options.redirectDefaults.redirectType);return e||(e=this.$constants.REDIRECT_TYPES[0]),e},getDefaultQueryParam(){let e=this.getJsonValue(this.options.redirectDefaults.queryParam);return e||(e=this.$constants.REDIRECT_QUERY_PARAMS[0]),e},getDefaultSlash(){return this.options.redirectDefaults.ignoreSlash},getDefaultCase(){return this.options.redirectDefaults.ignoreCase},getDefaultSourceUrls(){return[JSON.parse(JSON.stringify(this.getDefaultSourceUrl))]},getDefaultSourceUrl(){return{id:null,url:null,regex:!1,ignoreSlash:this.slash||this.getDefaultSlash||!1,ignoreCase:this.case||this.getDefaultCase||!1,errors:[],warnings:[]}},redirectQueryParams(){return 0<this.sourceUrls.filter(e=>e.regex).length?this.$constants.REDIRECT_QUERY_PARAMS.map(e=>(e.$isDisabled=!1,e.value==="exact"&&(e.$isDisabled=!0,this.queryParam.value==="exact"&&(this.queryParam=this.$constants.REDIRECT_QUERY_PARAMS.find(r=>!r.$isDisabled))),e)):this.$constants.REDIRECT_QUERY_PARAMS.map(e=>(e.$isDisabled=!1,e))}}),methods:u(n({},c("redirects",["create","update"])),{beginsWith(e,r){return r.indexOf(e)===0||e.substr(0,r.length)===r},addUrl(){this.sourceUrls.push(JSON.parse(JSON.stringify(this.getDefaultSourceUrl)))},removeUrl(e){this.$delete(this.sourceUrls,e)},addRedirects(){this.genericError=!1,this.addingRedirect=!0,this.sourceUrls.map(e=>(e.url.substr(0,4)!=="http"&&e.url.substr(0,1)!=="/"&&0<e.url.length&&!e.regex&&(e.url="/"+e.url),e)),this.create({sourceUrls:this.sourceUrls,targetUrl:this.targetUrl,queryParam:this.queryParam.value,customRules:this.customRules,redirectType:this.redirectType.value,redirectTypeHasTarget:this.redirectTypeHasTarget(),group:this.log404?"404":"manual"}).then(()=>{this.$emit("added-redirect"),this.$bus.$emit("added-redirect"),this.reset()}).catch(e=>{this.handleError(e)})},saveChanges(){this.genericError=!1,this.addingRedirect=!0,this.sourceUrls[0].url.substr(0,4)!=="http"&&this.sourceUrls[0].url.substr(0,1)!=="/"&&0<this.sourceUrls[0].url.length&&!this.sourceUrls[0].regex&&(this.sourceUrls[0].url="/"+this.sourceUrls[0].url),this.update({id:this.sourceUrls[0].id,payload:{sourceUrls:this.sourceUrls,targetUrl:this.targetUrl,queryParam:this.queryParam.value,customRules:this.customRules,redirectType:this.redirectType.value,redirectTypeHasTarget:this.redirectTypeHasTarget()}}).then(()=>{this.reset()}).catch(e=>{console.error(e),this.handleError(e)})},handleError(e){if(e.response.status!==409||!e.response.body.failed||!e.response.body.failed.length){this.genericError=!0,this.addingRedirect=!1;return}const r=[],t=e.response.body.failed,i="A redirect already exists for this source URL. To make changes, edit the original instead.";t.forEach(s=>{const a=this.sourceUrls.findIndex(l=>l.url===s.url||s);a!==-1&&(this.sourceUrls[a].errors.find(l=>l===s.error||l===i)||this.sourceUrls[a].errors.push(s.error||i),r.push(a))});for(let s=this.sourceUrls.length-1;0<=s;s--)r.includes(s)||this.$delete(this.sourceUrls,s);this.addingRedirect=!1},updateTargetUrl(e){this.targetUrl=e,this.targetUrlErrors=this.hasTargetUrlErrors,this.targetUrlWarnings=this.hasTargetUrlWarnings},reset(){if(this.showAdvancedSettings=!1,this.addingRedirect=!1,this.edit)return;const e=this.$constants.REDIRECT_TYPES.find(t=>t.value===this.type),r=this.$constants.REDIRECT_QUERY_PARAMS.find(t=>t.value===this.query);this.sourceUrls=[JSON.parse(JSON.stringify(this.getDefaultSourceUrl))],this.targetUrl=null,this.targetUrlErrors=[],this.targetUrlWarnings=[],this.redirectType=e||{label:"301 Moved Permanently",value:301},this.queryParam=r||{label:"Ignore all parameters",value:"ignore"},this.customRules=[]},checkForDuplicates(){const e=[];this.sourceUrls.forEach((r,t)=>{if(!(!r.url||r.errors.length)){if(e.includes(r.url.replace(/\/$/,""))){this.sourceUrls[t].errors.push("This is a duplicate of a URL you are already adding. You can only add unique source URLs.");return}e.push(r.url.replace(/\/$/,""))}}),this.updateTargetUrl(this.targetUrl)},redirectTypeHasTarget(){return this.redirectType&&(typeof this.redirectType.noTarget=="undefined"||!this.redirectType.noTarget)}}),mounted(){this.sourceUrls=this.getDefaultSourceUrls,this.url&&(this.sourceUrls=[n(n({},this.getDefaultSourceUrl),this.url)]),this.urls&&this.urls.length&&(this.sourceUrls=this.urls.map(t=>n(n({},this.getDefaultSourceUrl),t))),this.target&&(this.targetUrl=this.target),this.rules&&(this.customRules=this.rules);const e=this.$constants.REDIRECT_TYPES.find(t=>t.value===this.type)||this.getDefaultRedirectType;e&&(this.redirectType=e);const r=this.$constants.REDIRECT_QUERY_PARAMS.find(t=>t.value===this.query)||this.getDefaultQueryParam;r&&(this.queryParam=r)}},y={};var xe=o(Le,Te,Ee,!1,we,null,null,null);function we(e){for(let r in y)this[r]=y[r]}var ke=function(){return xe.exports}(),Ae=function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("div",{staticClass:"aioseo-redirects-blur"},[e.noCoreCard?e._e():t("core-card",{attrs:{slug:"addNewRedirection","header-text":e.strings.addNewRedirection,noSlide:!0}},[t("core-blur",[t("core-add-redirection",{attrs:{type:e.$constants.REDIRECT_TYPES[0].value,query:e.$constants.REDIRECT_QUERY_PARAMS[0].value,slash:!0,case:!0}})],1)],1),e.noCoreCard?t("core-blur",[t("core-add-redirection",{attrs:{type:e.$constants.REDIRECT_TYPES[0].value,query:e.$constants.REDIRECT_QUERY_PARAMS[0].value,slash:!0,case:!0}})],1):e._e(),t("core-blur",[t("core-wp-table",{attrs:{filters:[],totals:{total:0,pages:0,page:1},columns:e.columns,rows:[],"search-label":e.strings.searchUrls,"bulk-options":e.bulkOptions,"additional-filters":e.additionalFilters}})],1)],1)},De=[];const Pe={components:{CoreAddRedirection:ke,CoreBlur:W,CoreCard:Y,CoreWpTable:G},props:{noCoreCard:Boolean},data(){return{strings:{addNewRedirection:"Add New Redirection",searchUrls:"Search URLs"},bulkOptions:[{label:"",value:""}]}},computed:{columns(){return[{slug:"source_url",label:"Source URL"},{slug:"target_url",label:"Target URL"},{slug:"hits",label:"Hits",width:"97px"},{slug:"type",label:"Type",width:"100px"},{slug:"group",label:"Group",width:"150px"},{slug:"enabled",label:this.$constants.GLOBAL_STRINGS.enabled,width:"80px"}]},additionalFilters(){return[{label:"Filter by Group",name:"group",options:[{label:"All Groups",value:"all"}].concat(this.$constants.REDIRECT_GROUPS)}]}}},U={};var Oe=o(Pe,Ae,De,!1,Me,null,null,null);function Me(e){for(let r in U)this[r]=U[r]}var Ie=function(){return Oe.exports}(),Be=function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("div",{class:{"aioseo-redirects":!0,"core-card":!e.noCoreCard}},[t("blur",{attrs:{noCoreCard:e.noCoreCard}}),t("cta",{attrs:{"cta-link":e.$links.getPricingUrl("redirects","redirects-upsell",e.parentComponentContext?e.parentComponentContext:null),"button-text":e.strings.ctaButtonText,"learn-more-link":e.$links.getUpsellUrl("redirects",e.parentComponentContext?e.parentComponentContext:null,"home"),"feature-list":[e.strings.serverRedirects,e.strings.automaticRedirects,e.strings.redirectMonitoring,e.strings.monitoring404,e.strings.fullSiteRedirects,e.strings.siteAliases]},scopedSlots:e._u([{key:"header-text",fn:function(){return[e._v(" "+e._s(e.strings.ctaHeader)+" ")]},proxy:!0},{key:"description",fn:function(){return[e.$isPro&&e.$addons.requiresUpgrade("aioseo-redirects")&&e.$addons.currentPlans("aioseo-redirects")?t("core-alert",{attrs:{type:"red"}},[e._v(" "+e._s(e.strings.thisFeatureRequires)+" "),t("strong",[e._v(e._s(e.$addons.currentPlans("aioseo-redirects")))])]):e._e(),e.$isPro&&e.$addons.isActive("aioseo-redirects")&&!e.$addons.hasMinimumVersion("aioseo-redirects")?t("core-alert",[e._v(" CHANGEME ")]):e._e(),e._v(" "+e._s(e.strings.redirectsDescription)+" ")]},proxy:!0}])})],1)},qe=[];const Fe={components:{Blur:Ie,CoreAlert:h,Cta:Q},props:{hasMinimumVersion:Boolean,noCoreCard:Boolean,parentComponentContext:String},data(){return{strings:{ctaButtonText:"Upgrade to Pro and Unlock Redirects",ctaHeader:this.$t.sprintf("Redirects are only available for licensed %1$s %2$s users.","AIOSEO","Pro"),serverRedirects:"Fast Server Redirects",automaticRedirects:"Automatic Redirects",redirectMonitoring:"Redirect Monitoring",monitoring404:"404 Monitoring",fullSiteRedirects:"Full Site Redirects",siteAliases:"Site Aliases",redirectsDescription:"Our Redirection Manager allows you to easily create and manage redirects for your broken links to avoid confusing search engines and users, as well as losing valuable backlinks. It even automatically sends users and search engines from your old URLs to your new ones.",thisFeatureRequires:"This feature requires one of the following plans:"}}}},C={};var Ne=o(Fe,Be,qe,!1,Ve,null,null,null);function Ve(e){for(let r in C)this[r]=C[r]}var ht=function(){return Ne.exports}();export{ht as R};
